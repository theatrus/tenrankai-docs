name: Test Tenrankai Marketing Site

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

env:
  CARGO_TERM_COLOR: always

jobs:
  # Full integration test disabled - server exits immediately in CI
  # TODO: Investigate why tenrankai server doesn't start in GitHub Actions
  # test:
  #   runs-on: ubuntu-latest
  #   ...

  test-content:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        submodules: recursive
    
    - name: Check required files
      run: |
        # Check config files
        for config in config.toml config.dev.toml config.production.toml; do
          if [ -f "tenrankai-dot-com/$config" ]; then
            echo "✓ Found $config"
          else
            echo "✗ Missing $config"
            exit 1
          fi
        done
        
        # Check templates
        for template in index.html.liquid about.html.liquid features.html.liquid; do
          if [ -f "tenrankai-dot-com/templates/pages/$template" ]; then
            echo "✓ Found $template"
          else
            echo "✗ Missing $template"
            exit 1
          fi
        done
        
        # Check documentation
        for doc in 00-quick-start.md 01-installation.md 02-core-concepts.md; do
          if [ -f "tenrankai-dot-com/posts/docs/$doc" ]; then
            echo "✓ Found $doc"
          else
            echo "✗ Missing $doc"
            exit 1
          fi
        done
    
    - name: Validate TOML configs
      run: |
        pip install toml -q
        python3 scripts/validate_config.py